<!DOCTYPE html>
<html>
  <head>
    <title>My experiment</title>
    <script src="https://unpkg.com/jspsych@8.2.2"></script>
    <script src="https://unpkg.com/@jspsych/plugin-html-keyboard-response@2.1.0"></script>
    <script src="https://unpkg.com/@jspsych/plugin-image-keyboard-response@2.1.0"></script>
    <script src="https://unpkg.com/@jspsych/plugin-video-keyboard-response@2.1.1"></script>
    <script src="https://unpkg.com/@jspsych/plugin-preload@2.1.0"></script>
    <script src="https://unpkg.com/@jspsych/plugin-survey-multi-choice@2.1.0"></script>
    <script src="https://unpkg.com/@jspsych-contrib/plugin-pipe"></script>
    <link href="https://unpkg.com/jspsych@8.2.2/css/jspsych.css" rel="stylesheet" type="text/css" />
  </head>
  <body></body>
  <script>
   // Will need to make a qualtrics survey probing autism traits link to the experiment URL
   /* initialize jsPsych */
    var jsPsych = initJsPsych({
      on_finish: function() {
        jsPsych.data.displayData();
      }
    });

    /* create timeline */
    var timeline = [];

    /* preload videos */
    var images = ['https://raw.githubusercontent.com/WilderHartwell/jellema2024/main/data/stim/40_frown.jpg', 'https://raw.githubusercontent.com/WilderHartwell/jellema2024/main/data/stim/45_frown.jpg', 'https://raw.githubusercontent.com/WilderHartwell/jellema2024/main/data/stim/50_frown.jpg', 'https://raw.githubusercontent.com/WilderHartwell/jellema2024/main/data/stim/55_frown.jpg', 'https://raw.githubusercontent.com/WilderHartwell/jellema2024/main/data/stim/60_frown.jpg', 'https://raw.githubusercontent.com/WilderHartwell/jellema2024/main/data/stim/40_smile.jpg', 'https://raw.githubusercontent.com/WilderHartwell/jellema2024/main/data/stim/45_smile.jpg', 'https://raw.githubusercontent.com/WilderHartwell/jellema2024/main/data/stim/50_smile.jpg', 'https://raw.githubusercontent.com/WilderHartwell/jellema2024/main/data/stim/55_smile.jpg', 'https://raw.githubusercontent.com/WilderHartwell/jellema2024/main/data/stim/60_smile.jpg', 'https://raw.githubusercontent.com/WilderHartwell/jellema2024/main/data/stim/neutral_frown.JPEG', 'https://raw.githubusercontent.com/WilderHartwell/jellema2024/main/data/stim/neutral_smile.JPEG']
    var video = ['https://raw.githubusercontent.com/WilderHartwell/jellema2024/main/data/stim/Frown_first_mirrored_distort_final.mp4', 'https://raw.githubusercontent.com/WilderHartwell/jellema2024/main/data/stim/Frown_first_mirrored_distort_reverse.mp4', 'https://raw.githubusercontent.com/WilderHartwell/jellema2024/main/data/stim/Smile_first_final.mp4', 'https://raw.githubusercontent.com/WilderHartwell/jellema2024/main/data/stim/Smile_first_reverse.mp4'];
    var preload = {
      type: jsPsychPreload,
      video: video,
      images: images
    };
    timeline.push(preload);
 

    /* welcome message */
    var welcome = {
      type: jsPsychHtmlKeyboardResponse,
      stimulus: "Welcome to the experiment. Press any key to begin."
    };
    timeline.push(welcome);
// Update the instructions with the correct identity photos. Identity B is the distorted one
    /* instructions */
    var instructions = {
      type: jsPsychHtmlKeyboardResponse,
      stimulus: `
        <p>For a few minutes you will see videos of two characters making faces.</p>
        <p>On the <b>left</b> is <b>Identity A</b> and on the <b>right</b> is <b> Identity B</b>.
        <p> <img src="https://raw.githubusercontent.com/WilderHartwell/jellema2024/main/data/stim/neutral_smile.JPEG"
          width="300" 
          height="400"/> 
          <img src="https://raw.githubusercontent.com/WilderHartwell/jellema2024/main/data/stim/neutral_frown.JPEG"
          width="300"
          height="400"/></p> 
        <p>All you need to do is focus on watching the videos.</p>
        <p>Press any key to begin.</p>
      `,
      post_trial_gap: 2000
    };
    timeline.push(instructions);

    /* test trials */
    var acq_stimuli = [
      { stimulus: ['https://raw.githubusercontent.com/WilderHartwell/jellema2024/main/data/stim/Frown_first_mirrored_distort_final.mp4'] },
      { stimulus: ['https://raw.githubusercontent.com/WilderHartwell/jellema2024/main/data/stim/Frown_first_mirrored_distort_reverse.mp4'] },
      { stimulus: ['https://raw.githubusercontent.com/WilderHartwell/jellema2024/main/data/stim/Smile_first_final.mp4'] },
      { stimulus: ['https://raw.githubusercontent.com/WilderHartwell/jellema2024/main/data/stim/Smile_first_reverse.mp4'] }
    ];

    var acq = {
      type: jsPsychVideoKeyboardResponse,
      stimulus: function() {
  return jsPsych.timelineVariable('stimulus');
},
      start: 0,
      trial_ends_after_video: true,
      rate: 1,
      post_trial_gap: 1000
    };

    var acq_procedure = {
      timeline: [acq],
      timeline_variables: acq_stimuli,
      randomize_order: true,
      repetitions: 1,
      response_ends_trial: false,
    };
    timeline.push(acq_procedure);

    // Define the break trial
var break_block = {
  type: jsPsychHtmlKeyboardResponse, 
  stimulus: `
            <p><b>Break</b></p>
            <p>Please take a break. When you are ready, you can continue with the experiment by pressing the Space bar.</p>
            `,
  choices: [' ', 'Space'], // The key(s) that will end the break trial
  // optional: add data to the break trial
  data: {
    trial_type: 'break'
  }
};
timeline.push(break_block)

var acq_procedure_2 = {
      timeline: [acq],
      timeline_variables: acq_stimuli,
      randomize_order: true,
      repetitions: 1,
      response_ends_trial: false,
    };
    timeline.push(acq_procedure_2);

var instructions_2 = {
  type: jsPsychHtmlKeyboardResponse,
      stimulus: `
        <p>You will see faces and you must decide if the face looks more like Identity A or Identity B.</p>
        <p>Press <b>F</b> for identity A and <b>J</b> for Identity B.</p>
        <p>Press any key to begin.</p>
      `,
      post_trial_gap: 2000
    };
    timeline.push(instructions_2);

var test_stimuli = [
  {stimulus: ['https://raw.githubusercontent.com/WilderHartwell/jellema2024/main/data/stim/40_frown.jpg'], correct_response: 'j'}, //40% identity B, 60% identiy A
  {stimulus: ['https://raw.githubusercontent.com/WilderHartwell/jellema2024/main/data/stim/45_frown.jpg'], correct_response: 'j'}, //45% identity B, 55% identity A
  {stimulus: ['https://raw.githubusercontent.com/WilderHartwell/jellema2024/main/data/stim/50_frown.jpg'], correct_response: 'j'}, //50% identiy B, 50% identity A MUST RESEARCH HOW TO INCLUDE TWO CORRECT VALUES
  {stimulus: ['https://raw.githubusercontent.com/WilderHartwell/jellema2024/main/data/stim/55_frown.jpg'], correct_response: 'j'}, //55% identity B, 45% identity A
  {stimulus: ['https://raw.githubusercontent.com/WilderHartwell/jellema2024/main/data/stim/60_frown.jpg'], correct_response: 'j'}, //60% identity B, 45% identiy A
  {stimulus: ['https://raw.githubusercontent.com/WilderHartwell/jellema2024/main/data/stim/40_smile.jpg'], correct_response: 'f'}, //40% identity B, 60% identiy A
  {stimulus: ['https://raw.githubusercontent.com/WilderHartwell/jellema2024/main/data/stim/45_smile.jpg'], correct_response: 'f'}, //45% identity B, 55% identity A
  {stimulus: ['https://raw.githubusercontent.com/WilderHartwell/jellema2024/main/data/stim/50_smile.jpg'], correct_response: 'f'}, //50% identiy B, 50% identity A MUST RESEARCH HOW TO INCLUDE TWO CORRECT VALUES
  {stimulus: ['https://raw.githubusercontent.com/WilderHartwell/jellema2024/main/data/stim/55_smile.jpg'], correct_response: 'f'}, //55% identity B, 45% identity A
  {stimulus: ['https://raw.githubusercontent.com/WilderHartwell/jellema2024/main/data/stim/60_smile.jpg'], correct_response: 'f'} //60% identity B, 45% identiy A
];

var test = {
  type: jsPsychImageKeyboardResponse,
  stimulus: jsPsych.timelineVariable('stimulus'),
  choices: ['f', 'j'],
  data: {
    task: 'response',
    correct_response: jsPsych.timelineVariable('correct_response')
  },
  post_trial_gap: 1000,
  prompt:` 
          <p><b>F</b> = Identity A, <b>J</b> = Identity B</p>
    `,
  stimulus_height: 806, //4032
  stimulus_width: 604 //3024
};

var test_procedure = {
  timeline: [test],
  timeline_variables: test_stimuli,
  randomize_order: false,
  repetitions: 2,
  response_ends_trial: true
};
timeline.push(test_procedure);

// Post-experiment questionnaire
var survey = {
  type: jsPsychSurveyMultiChoice,
  questions: [
    {
      prompt: "What was the disposition of Identity A towards you?",
      name: 'Question1',
      options: ['Positive', 'Neutral', 'Negative', 'I do not know'],
      required: true
    },
    {
      prompt: "What was the disposition of Identiy B towards you?",
      name: 'Question2',
      options: ['Positive', 'Neutral', 'Negative', 'I do not know'],
      required: true
    },
  ]
}
timeline.push(survey);

var thank_you = {
  type: jsPsychHtmlKeyboardResponse,
  stimulus: `
  <p> Thank you for taking the time to complete this experiment! </p>
  <p> Press any key to end the experiment. </p>
  `
}
timeline.push(thank_you)

// This ID is provided by pipe.jspsych.org.
const expID = "bwwbl5eJeBwl";

// Generate a random participant ID.
const participantID = jsPsych.randomization.randomID(10);

const save_data = {
  type: jsPsychPipe,
  action: "save",
  experiment_id: expID,
  filename: `${participantID}.csv`,
  data_string: ()=>jsPsych.data.get().csv()
};
timeline.push(save_data);
// Do we need to do anything in order for the data to be saved? Check the more detailed tutorials. I know there's some data saving on close that you can do
    /* start the experiment */
    jsPsych.run(timeline);
  </script>
</html>